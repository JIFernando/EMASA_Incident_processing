<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition template="/WEB-INF/templates/plantilla.xhtml" 
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="title">Editar aviso</ui:define>

    <ui:define name="contenido">

        <h:form id="editarAviso">
            <p:accordionPanel multiple="true">

                <p:tab title="Resumen">

                    <h:panelGrid columns="5">
                        <h:outputLabel value="ID" />
                        <h:inputText value="#{mostrarAviso.aviso.id_aviso}" disabled="true"/>
                        <h:outputLabel value="" />
                        <h:outputLabel value="Inicio avería" />
                        <h:panelGrid columns="2" cellpadding="5">
                            <p:calendar id="button" value="#{mostrarAviso.aviso.inic_Averia}" showOn="button" />
                        </h:panelGrid>

                        <h:outputLabel value="Brigada" />
                        <h:inputText value="#{mostrarAviso.aviso.brigada}"/>
                        <h:outputLabel value="" />
                        <h:outputLabel value="Fin avería" />
                        <h:panelGrid columns="2" cellpadding="5">
                            <p:calendar id="button2" value="#{mostrarAviso.aviso.fin_averia}" showOn="button" />
                        </h:panelGrid>

                        <c:if test="#{controlAutorizacion.empleado.rol == 'SUPERVISOR'}">
                            <p:outputLabel value="Estado" style="margin-left: 13px"/>
                            <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5" columnClasses="label, value">
                                <p:outputLabel for="estado" value="" />
                                <h:selectOneMenu id="estado" value="#{listaAvisos.aviso.estado}">
                                    <f:selectItem itemLabel="SIN ATENDER" itemValue="SIN_ATENDER" />
                                    <f:selectItem itemLabel="EN PROCESO" itemValue="EN_PROCESO" />
                                    <f:selectItem itemLabel="CERRADO" itemValue="CERRADO" />
                                </h:selectOneMenu>
                            </h:panelGrid>
                        </c:if>

                        <c:if test="#{controlAutorizacion.empleado.rol == 'NORMAL'}">
                            <p:outputLabel value="Estado" style="margin-left: 13px"/>
                            <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5" columnClasses="label, value">
                                <p:outputLabel for="estado" value="" />
                                <h:selectOneMenu id="estado" value="#{listaAvisos.aviso.estado}" disabled="true">
                                    <f:selectItem itemLabel="SIN ATENDER" itemValue="SIN_ATENDER" />
                                    <f:selectItem itemLabel="EN PROCESO" itemValue="EN_PROCESO" />
                                    <f:selectItem itemLabel="CERRADO" itemValue="CERRADO" />
                                </h:selectOneMenu>
                            </h:panelGrid>
                        </c:if>


                        <c:if test="#{controlAutorizacion.empleado.rol == 'SUPERVISOR'}">
                            <p:outputLabel value="Prioridad" style="margin-left: 13px"/>
                            <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5" columnClasses="label, value">
                                <p:outputLabel for="prioridad" value="" />
                                <h:selectOneMenu id="prioridad" value="#{mostrarAviso.aviso.prioridad}">
                                    <f:selectItem itemLabel="URGENTE" itemValue="URGENTE"/>
                                    <f:selectItem itemLabel="PLANIFICADO" itemValue="PLANIFICADO" />
                                </h:selectOneMenu>             
                            </h:panelGrid>
                        </c:if>

                        <c:if test="#{controlAutorizacion.empleado.rol == 'NORMAL'}">
                            <p:outputLabel value="Prioridad" style="margin-left: 13px"/>
                            <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5" columnClasses="label, value">
                                <p:outputLabel for="prioridad" value="" />
                                <h:selectOneMenu id="prioridad" value="#{mostrarAviso.aviso.prioridad}" disabled="true">
                                    <f:selectItem itemLabel="URGENTE" itemValue="URGENTE"/>
                                    <f:selectItem itemLabel="PLANIFICADO" itemValue="PLANIFICADO" />
                                </h:selectOneMenu>             
                            </h:panelGrid>
                        </c:if>
                        
                        <h:outputLabel />
                        
                        <c:if test="#{controlAutorizacion.empleado.rol == 'SUPERVISOR'}">
                            <p:outputLabel value="Supervisor" style="margin-left: 13px"/>
                            <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5" columnClasses="label, value">
                                <p:outputLabel for="supervisor" value="" />
                                <h:selectOneMenu id="supervisor">
                                    <f:selectItem itemLabel="Supervisor 1" />
                                    <f:selectItem itemLabel="Supervisor 2"/>
                                    <f:selectItem itemLabel="Supervisor 3" />
                                </h:selectOneMenu>
                            </h:panelGrid>
                        </c:if>
                        
                        
                        <c:if test="#{controlAutorizacion.empleado.rol == 'NORMAL'}">
                            <p:outputLabel value="Supervisor" style="margin-left: 13px"/>
                            <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5" columnClasses="label, value">
                                <p:outputLabel for="supervisor" value="" />
                                <h:selectOneMenu id="supervisor" disabled="true">
                                    <f:selectItem itemLabel="Supervisor 1" />
                                    <f:selectItem itemLabel="Supervisor 2"/>
                                    <f:selectItem itemLabel="Supervisor 3" />
                                </h:selectOneMenu>
                            </h:panelGrid>
                        </c:if>
                        
                        
                    </h:panelGrid>
                </p:tab>
                <p:tab title="Diagnóstico">
                    <div align="center">
                        <h:selectManyCheckbox id="diagnosticos">
                            <f:selectItem id="arquetaRota" itemLabel="Arqueta rota" itemValue="1" />
                            <f:selectItem id="tuberia" itemLabel="Tubería rota" itemValue="2" />
                            <f:selectItem id="fuga" itemLabel="Fuga de agua" itemValue="3" />
                            <f:selectItem id="desborde" itemLabel="Desborde de presa" itemValue="4" />
                            <f:selectItem id="canaleta" itemLabel="Canaleta rota" itemValue="5" />
                        </h:selectManyCheckbox>
                    </div>
                </p:tab>

                <p:tab title="Observaciones">
                    <div align="center">
                        <p:inputTextarea value="#{mostrarAviso.aviso.observaciones}" rows="5" cols="90" />
                    </div>
                </p:tab>

                <p:tab title="Órdenes de trabajo">
                    <p:dataTable value="#{newot.datos}" var="orden" resizableColumns="true" emptyMessage="No hay datos">
                        <p:column headerText="Orden de trabajo">
                            <h:outputText value="#{orden.id_OT}" />
                        </p:column>

                        <p:column headerText="Fecha">
                            <h:outputText value="#{orden.fecha_creac}" />
                        </p:column>

                        <p:column headerText="Estado">
                            <h:outputText value="#{orden.estado}" />
                        </p:column>

                        <p:column headerText="Brigada">
                            <h:outputText value="#{orden.brigada_ot}" />
                        </p:column>
                    </p:dataTable><br/>

                    <div align="center">
                        <h:commandButton id="nuevaOrden" styleClass="boton" value="Nueva orden de trabajo"/>
                    </div>
                </p:tab>

                <p:tab title="Avisos vinculados">
                    <div class="row">
                        <div class="col-md-4">
                            <div>
                                <p:outputLabel value="Fecha: desde" />
                                <p:growl id="msgs" showDetail="true" />
                                <h:panelGrid columns="2" cellpadding="5">
                                    <p:calendar id="button" value="#{calendarView.date3}" showOn="button" />
                                </h:panelGrid>

                                <p:outputLabel value="Fecha: hasta" />

                                <h:panelGrid columns="2" cellpadding="5">
                                    <p:calendar id="button2" value="#{calendarView.date4}" showOn="button" />
                                </h:panelGrid>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <p:outputLabel value="Prioridad" style="margin-left: 13px"/>
                            <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5" columnClasses="label, value">
                                <p:outputLabel for="prioridad" value="" />
                                <p:selectOneListbox id="prioridad" value="#{listaAvisos.id_prioridad_seleccionada}">
                                    <f:selectItem itemLabel="URGENTE" itemValue="1"/>
                                    <f:selectItem itemLabel="PLANIFICADO" itemValue="2" />
                                    <f:selectItem itemLabel="TODOS" itemValue="3" />
                                </p:selectOneListbox>             
                            </h:panelGrid>
                        </div>
                        <div class="col-md-3">
                            <p:outputLabel value="Estado" style="margin-left: 13px"/>
                            <h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5" columnClasses="label, value">
                                <p:outputLabel for="estado" value="" />
                                <p:selectOneListbox id="estado" value="#{listaAvisos.id_estado_seleccionado}">
                                    <f:selectItem itemLabel="SIN ATENDER" itemValue="1" />
                                    <f:selectItem itemLabel="EN PROCESO" itemValue="2" />
                                    <f:selectItem itemLabel="CERRADO" itemValue="3" />
                                    <f:selectItem itemLabel="TODOS" itemValue="4" />
                                </p:selectOneListbox>
                            </h:panelGrid>
                        </div>
                    </div> 
                    <div class="row">          
                        <div class="col-md-4">
                            <div> <p:outputLabel value="Código de Aviso" /></div>
                            <div>     
                                <p:inputText value="#{controlTabla.id_aviso}"/>  </div>
                        </div>
                        <div class="col-md-4" style="margin-top: 13px; margin-left: 13px">
                            <h:commandButton class="boton" value="Buscar" action="#{controlTabla.filtrar(listaAvisos.id_prioridad_seleccionada, listaAvisos.id_estado_seleccionado, calendarView.date3, calendarView.date4)}"/>
                        </div>
                    </div>
                    <p:separator />

                    <c:if test="#{! controlTabla.filtrado}">
                        <p:dataTable value="#{listaAvisos.listaAvisos}" var="avisos" resizableColumns="true" emptyMessage="No hay datos">
                            <p:column headerText="Aviso">
                                <h:outputText value="#{avisos.id_aviso}" />
                            </p:column>

                            <p:column headerText="Fecha">
                                <h:outputText value="#{avisos.fecha_creacion}" />
                            </p:column>

                            <p:column headerText="Ubicacion">
                                <h:outputText value="#{avisos.ubicacion}" />
                            </p:column>

                            <p:column headerText="Prioridad">
                                <h:outputText value="#{avisos.prioridad}" />
                            </p:column>
                            <p:column headerText="Estado">
                                <h:outputText value="#{avisos.estado}" />
                            </p:column>
                            <p:column >
                                <p:commandButton value = "Vincular" id="mostrar_aviso" action="vincular.xhtml" style="margin-left: 7px"/>
                            </p:column>
                        </p:dataTable>


                    </c:if>
                    <c:if test="#{controlTabla.filtrado}">
                        <h:outputText value="Resultado filtrado por:  Estado:#{controlTabla.estado} Prioridad:#{controlTabla.prioridad} Fecha desde:#{controlTabla.fecha_fin}  Fecha hasta:#{controlTabla.fecha_inicio} Código de aviso:#{controlTabla.id_aviso}
                                      Para realizar una nueva búsqueda filtrada, selecione de nuevo los parámetros"/>
                        <p:dataTable value="#{controlTabla.listaAvisosFiltrados}" var="avisos_filtro" resizableColumns="true" emptyMessage="No hay datos">
                            <p:column headerText="Aviso">
                                <h:outputText value="#{avisos_filtro.id_aviso}" />
                            </p:column>

                            <p:column headerText="Fecha">
                                <h:outputText value="#{avisos_filtro.fecha_creacion}" />
                            </p:column>

                            <p:column headerText="Ubicacion">
                                <h:outputText value="#{avisos_filtro.ubicacion}" />
                            </p:column>

                            <p:column headerText="Prioridad">
                                <h:outputText value="#{avisos_filtro.prioridad}" />
                            </p:column>
                            <p:column headerText="Estado">
                                <h:outputText value="#{avisos_filtro.estado}" />
                            </p:column>
                            <p:column >
                                <p:commandButton value = "Vincular" id="mostrar_aviso" action="vincular.xhtml" style="margin-left: 7px"/>
                            </p:column>
                        </p:dataTable>
                    </c:if>
                    <br/>

                    <div align="center">
                       
                    </div>
                </p:tab>

                <p:tab title="Brigada">
                    <div class="row">
                        <div class="col-md-3">
                            <div> <p:outputLabel value="Brigada" /> </div>
                        </div>

                        <div class="col-md-4">
                            <div> <p:inputText value="#{controlAsignarBrigadas.id}"/> </div>
                        </div>
                        <!-- -->
                        <br />
                        <br />
                        <div class="col-md-3">
                            <div> <p:outputLabel value="Contrata" /> </div>
                        </div>   
                        <div class="col-md-4">
                            <div> <p:inputText value="#{controlAsignarBrigadas.contrata}"/> </div>
                        </div>
                        <!-- -->
                        <div class="col-md-1">
                            <h:commandButton value="Buscar" styleClass="boton" action="#{controlAsignarBrigadas.filtrar()}"/>
                        </div>

                        <br />
                    </div>
                    <br />        

                    <p:separator />

                    <c:if test="#{! controlAsignarBrigadas.filtrado}">

                        <p:dataTable value="#{listaBrigadas.listaBrigadas}" var="brigadas" resizableColumns="true" emptyMessage="No hay datos">
                            <p:column headerText="Brigada">
                                <h:outputText value="#{brigadas.id}" />
                            </p:column>

                            <p:column headerText="Contrata">
                                <h:outputText value="#{brigadas.contrata}" />
                            </p:column>

                            <p:column headerText="Capataz">
                                <h:outputText value="#{brigadas.nombreCapataz}" />
                            </p:column>

                            <p:column headerText="Operarios">
                                <h:outputText value="#{brigadas.nombreOperarios}" />
                            </p:column>
                        </p:dataTable>


                    </c:if>
                    <c:if test="#{controlAsignarBrigadas.filtrado}">
                        <p:dataTable value="#{controlAsignarBrigadas.listaBrigadasFiltradas}" var="brigadas_filtro" resizableColumns="true" emptyMessage="No hay datos">
                            <p:column headerText="Brigada">
                                <h:outputText value="#{brigadas_filtro.id}" />
                            </p:column>

                            <p:column headerText="Contrata">
                                <h:outputText value="#{brigadas_filtro.contrata}" />
                            </p:column>

                            <p:column headerText="Capataz">
                                <h:outputText value="#{brigadas_filtro.nombreCapataz}" />
                            </p:column>

                            <p:column headerText="Operarios">
                                <h:outputText value="#{brigadas_filtro.nombreOperarios}" />
                            </p:column>
                        </p:dataTable>
                    </c:if>

                    <br />
                </p:tab>

                <p:tab title="Ubicación">
                    <div align="center">
                        <p:panelGrid columns="2">
                            <h:outputLabel value="Ubicación: " />
                            <h:inputText value="#{mostrarAviso.aviso.ubicacion}" />

                            <h:outputLabel value="Coordenadas: " />
                            <h:inputText value="#{mostrarAviso.aviso.coordenada}" />
                        </p:panelGrid>
                    </div><br/>
                </p:tab>
            </p:accordionPanel><br/>


            <div align="center">
                <script src='https://maps.googleapis.com/maps/api/js?v=3.exp'></script><div style='overflow:hidden;height:440px;width:700px;'><div id='gmap_canvas' style='height:440px;width:700px;'></div><div><small><a href="http://embedgooglemaps.com">									embed google map							</a></small></div><div><small><a href="https://botonmegusta.org">botonmegusta.org</a></small></div><style>#gmap_canvas img{max-width:none!important;background:none!important}</style></div><script type='text/javascript'>function init_map(){var myOptions = {zoom:11, center:new google.maps.LatLng(36.721261, - 4.421265500000004), mapTypeId: google.maps.MapTypeId.ROADMAP}; map = new google.maps.Map(document.getElementById('gmap_canvas'), myOptions); marker = new google.maps.Marker({map: map, position: new google.maps.LatLng(36.721261, - 4.421265500000004)}); infowindow = new google.maps.InfoWindow({content:'Malaga, Spain'}); google.maps.event.addListener(marker, 'click', function(){infowindow.open(map, marker); }); infowindow.open(map, marker); }google.maps.event.addDomListener(window, 'load', init_map);</script>
            </div><br/>

            <div align="center">
                <a href="grid_avisos.xhtml" class="boton">Guardar</a>
                <a href="grid_avisos.xhtml" class="boton">Volver atrás</a>
                <!-- 
                <a href="grid_avisos.xhtml" class="boton" action="#{listaAvisos.modificarAviso(listaAvisos.aviso, calendarView.date3, calendarView.date4,
                                                                    listaAvisos.aviso.ubicacion, listaAvisos.aviso.coordenada, listaAvisos.aviso.observaciones,
                                                                    listaAvisos.aviso.prioridad, listaAvisos.aviso.estado)}">Guardar</a>
                -->
                
            </div><br/><br/><br/><br/>
        </h:form>
    </ui:define>
</ui:composition>